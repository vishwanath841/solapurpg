{% extends 'base.html' %}

{% block content %}
<style>
    .navbar {
        display: none;
    }

    .main-content {
        padding: 0 !important;
        max-width: none !important;
        margin: 0 !important;
    }

    .container {
        max-width: none !important;
        padding: 0 !important;
        margin: 0 !important;
    }

    body {
        background: #F3F4F6;
    }
</style>

<div class="dashboard-container">
    <aside class="sidebar">
        <div class="sidebar-brand">
            <i class="fa-solid fa-staff-snake"></i>
            <span>SHM</span>
        </div>
        <ul class="sidebar-menu">
            <li><a href="{{ url_for('doctor.dashboard') }}" class="sidebar-link"><i
                        class="fa-solid fa-table-columns"></i> Dashboard</a></li>
            <li><a href="{{ url_for('doctor.patients') }}" class="sidebar-link active"><i class="fa-solid fa-users"></i>
                    Patient Management</a></li>
            <li><a href="{{ url_for('doctor.schedule') }}" class="sidebar-link"><i
                        class="fa-solid fa-calendar-check"></i> Appointments</a></li>
            <li><a href="{{ url_for('doctor.transactions') }}" class="sidebar-link"><i class="fa-solid fa-wallet"></i>
                    Transactions</a></li>
        </ul>
        <div style="margin-top: auto;">
            <a href="{{ url_for('auth.logout') }}" class="sidebar-link">
                <i class="fa-solid fa-right-from-bracket"></i> Log Out
            </a>
        </div>
    </aside>
    <main style="padding: 30px; overflow-y: auto;">
        <!-- Search -->
        <div style="margin-bottom:20px; display:flex; justify-content:space-between;">
            <h2>My Patients</h2>
            <div class="search-bar">
                <input type="text" id="patientSearch" placeholder="Search patients..." onkeyup="filterTable()">
            </div>
        </div>

        <div class="card">
            <table id="patientTable">
                <thead>
                    <tr>
                        <th>Patient Name</th>
                        <th>Last Visit</th>
                        <th>Medical History</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in patients %}
                    <tr>
                        <td style="font-weight:bold;">{{ p.name }}</td>
                        <td>{{ p.last_visit | replace('T', ' ') }}</td>
                        <td>{{ p.history or 'No records' }}</td>
                        <td>
                            <a href="{{ url_for('doctor.patient_details', patient_id=p.id) }}" class="btn btn-primary"
                                style="padding:5px 10px; font-size:0.8rem; text-decoration:none;">View Records</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4">No patients seen yet.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </main>
</div>

<script>
    function filterTable() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("patientSearch");
        filter = input.value.toUpperCase();
        table = document.getElementById("patientTable");
        tr = table.getElementsByTagName("tr");
        for (i = 0; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td")[0];
            if (td) {
                txtValue = td.textContent || td.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        }
    }
</script>
{% endblock %}