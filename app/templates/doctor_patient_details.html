{% extends 'base.html' %}

{% block content %}
<style>
    .navbar {
        display: none;
    }

    .main-content {
        padding: 0 !important;
        max-width: none !important;
        margin: 0 !important;
    }

    .container {
        max-width: none !important;
        padding: 0 !important;
        margin: 0 !important;
    }

    body {
        background: #F3F4F6;
    }
</style>

<div class="dashboard-container">
    <aside class="sidebar">
        <div class="sidebar-brand">
            <i class="fa-solid fa-staff-snake"></i>
            <span>SHM</span>
        </div>
        <ul class="sidebar-menu">
            <li><a href="{{ url_for('doctor.dashboard') }}" class="sidebar-link"><i
                        class="fa-solid fa-table-columns"></i> Dashboard</a></li>
            <li><a href="{{ url_for('doctor.patients') }}" class="sidebar-link active"><i class="fa-solid fa-users"></i>
                    Patient Management</a></li>
            <li><a href="{{ url_for('doctor.schedule') }}" class="sidebar-link"><i
                        class="fa-solid fa-calendar-check"></i> Appointments</a></li>
            <li><a href="{{ url_for('doctor.transactions') }}" class="sidebar-link"><i class="fa-solid fa-wallet"></i>
                    Transactions</a></li>
        </ul>
        <div style="margin-top: auto;">
            <a href="{{ url_for('auth.logout') }}" class="sidebar-link">
                <i class="fa-solid fa-right-from-bracket"></i> Log Out
            </a>
        </div>
    </aside>
    <main style="padding: 30px; overflow-y: auto;">

        <div style="margin-bottom: 20px;">
            <a href="{{ url_for('doctor.patients') }}"
                style="text-decoration: none; color: var(--text-muted); font-weight: 500;">
                <i class="fa-solid fa-arrow-left"></i> Back to List
            </a>
        </div>

        <div class="card" style="margin-bottom: 30px;">
            <div style="display: flex; gap: 20px; align-items: center;">
                <div
                    style="width: 80px; height: 80px; background: var(--primary-grad); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; font-weight: bold;">
                    {{ patient.full_name[:2] }}
                </div>
                <div>
                    <h2 style="margin: 0;">{{ patient.full_name }}</h2>
                    <p style="color: var(--text-muted); margin: 5px 0;">Patient ID: {{ patient.id }}</p>
                </div>
            </div>

            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #E5E7EB;">
                <h4 style="margin-bottom: 10px;">Medical History</h4>
                <p style="background: #F3F4F6; padding: 15px; border-radius: 8px;">
                    {{ patient.medical_history or 'No known medical history provided.' }}
                </p>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <!-- Past Appointments -->
            <div class="card">
                <h3>Past Appointments</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for appt in appointments %}
                        <tr>
                            <td>{{ appt.appointment_date | replace('T', ' ') }}</td>
                            <td><span class="status-{{ appt.status }}">{{ appt.status }}</span></td>
                            <td>{{ appt.notes or '-' }}</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="3">No appointments found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Prescriptions Given -->
            <div class="card">
                <h3>Prescriptions</h3>
                {% for rx in prescriptions %}
                <div
                    style="background: #F8FAFC; border: 1px solid #E2E8F0; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 5px;">
                        Date: {{ rx.created_at | replace('T', ' ') }}
                    </div>
                    <strong>Diagnosis:</strong> {{ rx.diagnosis }}<br>
                    <strong>Meds:</strong>
                    <ul style="margin: 5px 0; padding-left: 20px;">
                        {% for med in rx.medicines %}
                        <li>{{ med.name }} - {{ med.dosage }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% else %}
                <p>No prescriptions issued yet.</p>
                {% endfor %}
            </div>
        </div>

    </main>
</div>
{% endblock %}