{% extends 'base.html' %}

{% block content %}
<style>
    .navbar {
        display: none;
    }

    .main-content {
        padding: 0 !important;
        max-width: none !important;
        margin: 0 !important;
    }

    .container {
        max-width: none !important;
        padding: 0 !important;
        margin: 0 !important;
    }

    body {
        background: #F3F4F6;
    }
</style>

<div class="dashboard-container">
    <aside class="sidebar">
        <div class="sidebar-brand">
            <i class="fa-solid fa-staff-snake"></i>
            <span>SHM Patient</span>
        </div>
        <ul class="sidebar-menu">
            <li><a href="{{ url_for('patient.dashboard') }}" class="sidebar-link"><i
                        class="fa-solid fa-table-columns"></i> Dashboard</a></li>
            <li><a href="{{ url_for('patient.view_doctors') }}" class="sidebar-link active"><i
                        class="fa-solid fa-user-doctor"></i> Find Doctors</a></li>
            <li><a href="{{ url_for('patient.prescriptions') }}" class="sidebar-link"><i
                        class="fa-solid fa-file-prescription"></i> Prescriptions</a></li>
            <li><a href="{{ url_for('patient.billing') }}" class="sidebar-link"><i
                        class="fa-solid fa-file-invoice-dollar"></i> Billing</a></li>
            <li><a href="{{ url_for('patient.profile') }}" class="sidebar-link"><i class="fa-solid fa-user-gear"></i> My
                    Profile</a></li>
        </ul>
        <div style="margin-top: auto;">
            <a href="{{ url_for('auth.logout') }}" class="sidebar-link"><i class="fa-solid fa-right-from-bracket"></i>
                Log Out</a>
        </div>
    </aside>

    <main style="padding: 30px; overflow-y: auto;">
        <h2 style="margin-bottom: 20px;">Find a Doctor</h2>
        <div style="margin-bottom: 30px; display:flex; gap:10px;">
            <!-- Search/Filter could go here -->
            <input type="text" placeholder="Search by name or specialization..."
                style="padding:10px; border-radius:10px; border:1px solid #ddd; width:100%; max-width:400px;">
        </div>

        {% if doctors %}
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px;">
            {% for doc in doctors %}
            <div class="card"
                style="padding: 0; overflow: hidden; border:none; box-shadow: var(--shadow-sm); transition: transform 0.2s;">
                <div style="padding: 20px; background: white;">
                    <div style="display:flex; align-items:center; gap: 15px; margin-bottom: 15px;">
                        <div
                            style="width: 60px; height: 60px; background: #E0E7FF; color: #4F46E5; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold;">
                            {{ doc.profiles.full_name[:1] }}
                        </div>
                        <div>
                            <h3 style="margin: 0; font-size: 1.2rem;">Dr. {{ doc.profiles.full_name }}</h3>
                            <span style="color: var(--primary-color); font-weight: 500; font-size: 0.9rem;">{{
                                doc.specialization }}</span>
                        </div>
                    </div>

                    <div style="margin-bottom: 15px; font-size: 0.9rem; color: #555;">
                        <p style="margin: 5px 0;"><i class="fa-solid fa-money-bill-wave"
                                style="width:20px; color:#ccc;"></i> Fee: <strong>â‚¹{{ doc.consultation_fee }}</strong>
                        </p>
                        <p style="margin: 5px 0;"><i class="fa-regular fa-clock" style="width:20px; color:#ccc;"></i>
                            Days: {{ doc.available_days | join(', ') }}</p>
                    </div>

                    <form onsubmit="bookAppointment(event, '{{ doc.id }}')"
                        style="background: #F9FAFB; padding: 15px; margin: -20px; margin-top: 15px; border-top: 1px solid #eee;">
                        <label style="font-size: 0.8rem; font-weight: bold; display: block; margin-bottom: 5px;">Book
                            Appointment</label>
                        <input type="datetime-local" class="booking-date form-control" required
                            style="margin-bottom: 10px; width: 100%; border: 1px solid #ddd; padding: 8px; border-radius: 6px;">
                        <input type="text" class="booking-notes form-control" placeholder="Reason (Optional)"
                            style="margin-bottom: 10px; width: 100%; border: 1px solid #ddd; padding: 8px; border-radius: 6px;">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Book Now</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>No doctors available currently.</p>
        {% endif %}
    </main>
</div>

<script>
    async function bookAppointment(e, doctorId) {
        e.preventDefault();
        const form = e.target;
        const date = form.querySelector('.booking-date').value;
        const notes = form.querySelector('.booking-notes').value;
        const response = await fetch('/appointment/book', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ doctor_id: doctorId, appointment_date: date, notes: notes })
        });
        const result = await response.json();
        if (response.ok) { alert('Appointment booked successfully!'); window.location.href = "{{ url_for('patient.dashboard') }}"; }
        else { alert('Error: ' + result.error); }
    }
</script>
{% endblock %}